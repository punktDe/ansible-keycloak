keycloak:
  prefix:
    opt: /var/opt/keycloak
  domain:
  use_dehydrated: no
  network: host
  container_name: keycloak
  image: quay.io/keycloak/keycloak:22.0
  container_stop_timeout: 55
  volumes:
    "/opt/keycloak/conf": { host_dir: "{{ vars.keycloak.prefix.opt | quote }}/conf" }
    "/opt/keycloak/themes": { host_dir: "{{ vars.keycloak.prefix.opt | quote }}/themes" }
    "/opt/keycloak/providers": { host_dir: "{{ vars.keycloak.prefix.opt | quote }}/providers" }
    "/mnt/export": { host_dir: "{{ vars.keycloak.prefix.opt | quote }}/export" }
    "/mnt/entrypoint.sh": { host_dir: "{{ vars.keycloak.prefix.opt | quote }}/entrypoint.sh", relabel: unshared, read_only: true }
  ports:
    #0.0.0.0:7600: 7600
    127.0.0.1:8080: 8080
  environment:
    PROXY_ADDRESS_FORWARDING: "true"
    KC_CACHE: ispn
    KC_CACHE_STACK: tcp
    KEYCLOAK_FRONTEND_URL: "https://{{ vars.keycloak.domain }}/auth"
    KC_DB: mariadb
    KC_DB_URL_HOST: 127.0.0.1
    KC_DB_URL_DATABASE: keycloak
    KC_DB_USERNAME: keycloak
    KC_DB_PASSWORD:
    KEYCLOAK_ADMIN: admin
    KEYCLOAK_ADMIN_PASSWORD:
    KC_HOSTNAME: "{{ vars.keycloak.domain }}"
    KC_HOSTNAME_ADMIN_URL: "https://{{ vars.keycloak.domain }}"
    KC_PROXY: "edge"
    KEYCLOAK_BASE_URL: "https://{{ vars.keycloak.domain }}"
  entrypoint: /mnt/entrypoint.sh
